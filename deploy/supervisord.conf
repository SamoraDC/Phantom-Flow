[supervisord]
nodaemon=true
user=root
logfile=/var/log/supervisor/supervisord.log
pidfile=/var/run/supervisord.pid
childlogdir=/var/log/supervisor

[program:market-data]
command=/app/bin/market-data
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/market-data.err.log
stdout_logfile=/var/log/supervisor/market-data.out.log
environment=RUST_LOG="%(ENV_RUST_LOG)s",SYMBOLS="%(ENV_SYMBOLS)s",IPC_SOCKET_PATH="%(ENV_IPC_SOCKET_PATH)s"
priority=100

[program:risk-gateway]
command=/app/bin/risk_gateway
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/risk-gateway.err.log
stdout_logfile=/var/log/supervisor/risk-gateway.out.log
environment=IPC_SOCKET_PATH="%(ENV_IPC_SOCKET_PATH)s"
priority=200
startsecs=5
startretries=3

[program:strategy]
command=python -m uvicorn strategy.src.api.main:app --host 0.0.0.0 --port 8000
directory=/app
autostart=true
autorestart=true
stderr_logfile=/var/log/supervisor/strategy.err.log
stdout_logfile=/var/log/supervisor/strategy.out.log
environment=DATABASE_URL="%(ENV_DATABASE_URL)s",TIMEZONE="%(ENV_TIMEZONE)s",PYTHONPATH="/app"
priority=300
startsecs=10
startretries=3

# Event listener for monitoring process failures (optional, uncomment if needed)
# Requires a proper event listener script that reads from stdin and responds
# [eventlistener:process-monitor]
# command=/app/scripts/process_monitor.py
# events=PROCESS_STATE_FATAL
# buffer_size=10
